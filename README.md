# 游戏《阿瓦隆》<span style="font-size: smaller;">`pkudsa.avalon`</span>

（2025年春季数算B课程大作业）

---

## 🔗参考游戏《阿瓦隆》玩法链接
- [桌游《阿瓦隆(Avalon)》教学教程 完全指南](https://zhuanlan.zhihu.com/p/685062276)
- [卡牌《阿瓦隆》攻略](https://zhuanlan.zhihu.com/p/546211143)
- [不思议阿瓦隆攻略，阿瓦隆游戏攻略大全](https://www.youfanx.com/gonglue/202405/467216.html)

---

## 🌆背景故事

在卡姆兰的战场上，莫德雷德一剑刺入了亚瑟王的心脏。王的瞳孔逐渐涣散，战场上的风呼啸，我们的王，倒下了。

鲜血染红了亚瑟王的盔甲，那致命的一剑，砍碎了众人心中坚定的信仰，让曾经辉煌的圆桌骑士们陷入了绝望。

大魔法师梅林有着整个王国最渊博的学识、最智慧的头脑，面对此等危难时刻，他即刻反应过来，使用魔法号召还尚存斗志的骑士们。

“我们必须去阿瓦隆！”大魔法师梅林的声音在战场上回荡，“那里有治愈一切的力量，亚瑟王还有救！”

派西维尔，那位忠诚的骑士，立刻响应：“我愿意前往，为了我们的王！”

听到派西维尔振奋人心的呐喊，更多的骑士重拾他们的信仰与利剑，他们的眼中充满了对亚瑟王的敬意和对使命的执着，拼死与莫德雷德的爪牙们战斗着，掩护着梅林等人的撤退。

梅林领着六人各自伪装，借着骑士们的掩护，带着亚瑟王的遗体，踏上了前往阿瓦隆的路。

然而没过多久，梅林就敏锐地察觉到了异样，他所带着的六人并非全是忠于亚瑟王的骑士！他动用魔法感知到这支七人队里混入了三名莫德雷德的手下！

前往阿瓦隆会经过一条需要魔法的航道，梅林知道自己不能死，否则将没人为船只领航！

复活亚瑟王的神圣使命。我提议，我们不要卸下伪装，相互监视，逐步排除异己。愿亚瑟王与你同在，May King Arthur be with you！”

---

## 📢七人局《阿瓦隆》游戏规则

### 一、概述

一局游戏共7名玩家，玩家会分为两大阵营：**<span style="color: blue">【骑士】（蓝方）</span>**、**<span style="color: red">【反抗军】（红方）</span>**。

在游戏正式开始前的【夜晚】，所有玩家在该阶段根据自己的身份获得不同的信息。

游戏过程中会进行至多五次【任务】，【骑士】（蓝方）要确保任务成功且保护【梅林】，反抗军要破坏任务或者找出【梅林】，将其【刺杀】。

【任务】将由【队长】指定【队员】执行，在完成指定后，所有玩家将**讨论并投票决定**该任务是否执行。任务执行后，【队员】将进行匿名**投票**决定任务是否成功。

若一轮【任务】成功**记蓝色阵营胜利1次**，反之【任务】失败**记红色阵营胜利1次**，累积**先胜利3次的阵营宣告最终获胜**，即五局三胜制。因此蓝色阵营要积极参与进每次任务中，尽力让每轮任务成功；红色阵营则要隐藏自己的身份，尽可能参与进每次任务中破坏任务。

### 二、阵营与角色

每局游戏中，七名玩家将扮演以下六种角色：

- **骑士阵营（蓝方）**  
  - **胜利目标**：使三轮任务成功。
  - **角色能力**：
    - **【梅林】 (Loyal Coutier)**：夜晚阶段可看到所有红方玩家。
    - **【派西维尔】 (Percival)**：夜晚阶段看到【梅林】和【莫甘娜】（但无法区分两者）。
    - **【骑士】 (Knight)**：无特殊能力，需隐藏【派西维尔】身份并积极参与任务。

- **反抗军阵营（红方）**
  - **胜利目标**：使三轮任务失败，或通过刺杀【梅林】反败为胜。
  - **角色能力**：
    - **【莫甘娜】 (Morgana)**：假扮【梅林】，与红方玩家互认（【奥伯伦】除外）。
    - **【刺客】 (Assassin)**：在蓝方三轮任务成功后，可刺杀【梅林】（成功则红方胜利）。
    - **【奥伯伦】 (Oberon)**：红方成员，但与其他红方玩家不互认（红方队友也看不到他）。

**除【骑士】有2人外，其他角色有且只有1人。**  

### 三、游戏进程

**总体流程**：【夜晚】 → 【任务1】 → 【任务2】 → 【任务3】，视情况进行【任务4】【任务5】【刺杀】

![process](./pictures/process.png)

#### 1. **初始阶段**
- 每名玩家获得自己的角色。
- 随机选择首轮【队长】（后续【队长】按顺时针轮换）。

#### 2. **【夜晚】阶段**
1. **红方互认**（除【奥伯伦】）：【莫甘娜】、【刺客】睁眼确认队友。
2. **【梅林】睁眼**：查看所有红方玩家。
3. **【派西维尔】睁眼**：查看【梅林】和【莫甘娜】（但无法区分）。

#### 3. **【任务】流程（至多循环5轮）**

![mission](./pictures/mission.png)

1. **队长组队**  
   - 当前轮次的【队长】按当前轮次要求提名【队员】（如第1轮选2人）。
   - 可自由选择是否包含自己。  
   - **每轮【队员】人数**（七人局）：
     | 轮次 | 【任务1】 | 【任务2】 | 【任务3】 | 【任务4】（保护性） | 【任务5】 |  
     |------|-------|-------|-------|----------------|-------|  
     | 人数 | 2人   | 3人   | 3人   | 4人           | 4人   |  

2. **发言环节**  
   - 所有玩家按序发言。<span style="color: red">发言轮数和顺序仍待商讨。</span>
   - 发言内容需分析身份、质疑组队合理性。

3. **公投表决**  
   - 所有玩家同时对于是否【执行】本次任务进行投票（支持/反对）。投票结果公开。
   - **通过条件**：支持票过半（≥4）→ 【执行】任务。
   - **否决条件**：反对票过半（≥4）→ 【不执行】任务，顺时针更换【队长】重新选择【队员】（转到1）。
   - **连续三次否决**：由第四次组队的【队长】直接选定【队员】，不经表决强制【执行】任务。

4. **任务执行**  
   - 所有【队员】将进行一次匿名投票，决定任务的成功与否。蓝方只能投【成功票】，即只能支持任务成功；红方可自主选择投出【成功票】或者【失败票】，既可以支持任务成功，也可以导致任务失败。
   - **玩家只能看到最后任务成功或否，不能看到具体投票情况。**
   - **任务结果判定**：  
     - 【任务1】【任务2】【任务3】【任务5】中，【失败票】数量大于等于1，则任务失败，否则任务成功。
     - 【任务4】为保护轮，【失败票】数量大于等于2，则任务失败，否则任务成功。

5. **刺杀**
   - 当有三次【任务】成功，蓝方即将获胜时，【刺客】可以亮明身份，进行独立思考后选择杀死一名玩家。若成功杀死【梅林】，则红方反败为胜；否则蓝方依然获胜。

### 四、【游戏结束】与单局游戏的胜负判定

#### 1. **蓝方胜利条件**
- 累计三轮【任务】成功，且【刺客】刺杀【梅林】失败。

#### 2. **红方胜利条件**
- 累计三轮【任务】失败；
- 或蓝方达成三轮【任务】成功后，【刺客】成功刺杀【梅林】。

#### 3. **其他原因导致的游戏结束**
- **游戏中，某玩家的算法出现bug/超时/超token的犯规行为**——游戏立即结束，该玩家判负，本局作废，其余玩家记为平手。

---

## 💡各小组成员需要做什么

- 编写程序，使得自己的程序能够胜任《阿瓦隆》游戏玩家的角色！

- 在自己的程序中找到合适时机调用大语言模型（LLM）来进行判断其他玩家的发言、组织自己的发言以及辅助决策等操作！

---

## ✅对各小组程序的评价机制（未完待续……）

### 一、竞赛分——ELO机制

ELO机制是一种用于评估玩家竞技水平的动态评分系统，现广泛应用于电竞、体育联赛等场景。  

玩家通过胜负获得或失去分数，调整幅度取决于双方赛前评分差距。若高分玩家击败低分玩家，得分较少；反之低分玩家若爆冷获胜则得分更多。  

#### 游戏输赢对评分的影响

#### \*和基准AI（“人工智障”）的对战

我们要求大家的程序需要在能力上战胜几个“人工智障”。各组可以自行发起与基准AI的对战作为测试，对战结果将不会影响竞赛分。

### 二、算法分

AI的语言艺术、分析水平、推导能力等将体现在大作业的算法分里。

### 三、报告分

---

## 📪预选赛

---

## 🎇决赛

**时间**第16周的课上

---

## 🔗其他链接
- [AI集体破防！DeepSeek狼人杀封神之战，预判你的预判]([https://www.youfanx.com/gonglue/202405/467216.html](https://www.bilibili.com/video/BV1NGN9eAECT?buvid=Y64F886BB99B6286438BBAFB2AF37EBE8649&is_story_h5=false&mid=AeX96fkzlOGa11mBDedsTg%3D%3D&plat_id=168&share_from=ugc&share_medium=iphone&share_plat=ios&share_session_id=BF5CE729-CBB2-4D42-AEBA-DC82F6CD2257&share_source=WEIXIN&share_tag=s_i&spmid=main.my-history-search-result.option-more.0&timestamp=1743942232&unique_k=ZCUf2KS&up_id=5989845&share_source=weixin))
