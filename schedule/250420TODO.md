# 250420 TODO

## Overview

上周我们完成了主要文档的编写和游戏逻辑的初步实现，感谢各位的付出～

本周主要的任务是完善游戏逻辑和平台设计、补全各类文档。

以下为platform目录架构说明，【方括号标注TODO】。

```
./platform/
├── data/    # 存储 TinyDB 数据库文件 (users.json, codes.json, duels.json)
├── db/
│   └── database.py    # 提供数据库连接获取函数【数据库方案待改进】
├── dependencies/
│   └── auth.py    # 认证相关的依赖和中间件
├── doc.md
├── game/    # 游戏核心逻辑
│   ├── __init__.py
│   ├── avalon.py    # 玩家代码实例：Player类
│   ├── avalon_game_helper.py    # 辅助模块：LLM接口、系统日志、游戏日志【LLM限制待完善】
│   ├── baselines.py    # 预设的 AI 对手代码【待细化】
│   ├── referee.py    # 执行玩家代码和单回合对战逻辑【最后几个函数待细化】
│   └── visualizer.py    # 生成对战可视化图表【待细化】
├── main.py    # FastAPI 应用入口，挂载 Gradio 应用
├── requirements.txt    # 项目依赖
├── services/    # 业务逻辑层（连接数据库、裁判逻辑与前端交互）【待接入Tuvalon】
│   ├── code_service.py    # 代码管理相关服务
│   ├── duel_service.py    # 对战相关服务 (匹配、执行、记录)【elo机制待加入】
│   └── user_service.py    # 用户管理相关服务 (注册、登录、资料)【哈希密码待实现】
└── ui/    # Gradio UI 组件【待优化】
    ├── auth_app.py    # 认证 (登录/注册) 界面
    ├── components/    # 主应用各 Tab 的具体实现
    │   ├── __init__.py
    │   ├── code_tab.py
    │   ├── duel_tab.py
    │   ├── ladder_tab.py
    │   └── user_tab.py
    └── main_app.py    # 主应用界面 (包含多个Tab)【决赛模块待加入】
```

## TODO

分工方案详见issue. 

**每一项TODO都应创建新的分支。**

### game/

- 完善[avalon_game_helper.py](https://github.com/pkulab409/pkudsa.avalon/blob/51612c215d896c82e2ef49ea5fabf979daae04fd/platform/game/avalon_game_helper.py)中对LLM接口的限制

- 完善[baselines.py](https://github.com/pkulab409/pkudsa.avalon/blob/51612c215d896c82e2ef49ea5fabf979daae04fd/platform/game/baselines.py)（如有需要，补充其他AI对手代码）

- 根据[lib_data_format.md](https://github.com/pkulab409/pkudsa.avalon/blob/cac16c7b3e6fbb00d8f6a33ffd9741f9ad2e3252/documentation/technical_docs/lib_data_format.md)完善[referee.py](https://github.com/pkulab409/pkudsa.avalon/blob/51612c215d896c82e2ef49ea5fabf979daae04fd/platform/game/referee.py), [avalon_game_helper.py](https://github.com/pkulab409/pkudsa.avalon/blob/51612c215d896c82e2ef49ea5fabf979daae04fd/platform/game/avalon_game_helper.py)中的游戏日志逻辑

- 游戏界面可视化优化[visualizer.py](https://github.com/pkulab409/pkudsa.avalon/blob/51612c215d896c82e2ef49ea5fabf979daae04fd/platform/game/visualizer.py)

### db/

- 优化数据库方案[database.py](https://github.com/pkulab409/pkudsa.avalon/blob/902ccecbec476d91619ad8d42c08b52c4dfb4a16/platform/db/database.py)

### services/

- 对战线程管理实现[duel_service.py](https://github.com/pkulab409/pkudsa.avalon/blob/902ccecbec476d91619ad8d42c08b52c4dfb4a16/platform/services/duel_service.py)

- elo机制实现[duel_service.py](https://github.com/pkulab409/pkudsa.avalon/blob/902ccecbec476d91619ad8d42c08b52c4dfb4a16/platform/services/duel_service.py)

- 用户管理优化，哈希密码[user_service.py](https://github.com/pkulab409/pkudsa.avalon/blob/902ccecbec476d91619ad8d42c08b52c4dfb4a16/platform/services/user_service.py) 

- 沙箱执行器优化[code_service.py](https://github.com/pkulab409/pkudsa.avalon/blob/902ccecbec476d91619ad8d42c08b52c4dfb4a16/platform/services/code_service.py)

- 其他安全执行模块补充

### ui/

- 界面优化

- 决赛模块补充[main_app.py](https://github.com/pkulab409/pkudsa.avalon/blob/c242834d710eec82ca8d8fafcee08691c8a01639/platform/ui/main_app.py)